name: Manual Publish to PyPI

on:
  workflow_dispatch:
    inputs:
      version:
        description: 'Version to publish (e.g., 0.2.0, leave empty to use current version)'
        required: false
        type: string

jobs:
  deploy:
    runs-on: ubuntu-latest
    permissions:
      # IMPORTANT: this permission is mandatory for trusted publishing
      id-token: write
      contents: read

    steps:
    - uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: "3.10"

    - name: Install uv
      uses: astral-sh/setup-uv@v3

    - name: Update version if specified
      if: inputs.version != ''
      run: |
        uv version ${{ inputs.version }}
        echo "Updated version to ${{ inputs.version }}"

    - name: Get current version
      id: get_version
      run: |
        current_version=$(uv version --short)
        echo "version=$current_version" >> $GITHUB_OUTPUT
        echo "Current version: $current_version"

    - name: Build package
      run: uv build

    - name: Publish package distributions to PyPI
      uses: pypa/gh-action-pypi-publish@release/v1
      with:
        print-hash: true

    - name: Summary
      run: |
        echo "### Manual Publish Summary" >> $GITHUB_STEP_SUMMARY
        echo "âœ… Version: ${{ steps.get_version.outputs.version }}" >> $GITHUB_STEP_SUMMARY
        echo "ðŸš€ Successfully published to PyPI" >> $GITHUB_STEP_SUMMARY
